#file: noinspection YAMLSchemaValidation
workflows:
  implement_ticket:
    description: "Given a ticket or file, produce understanding, impact, plan, diffs, tests, and a ticket-ready summary."
    steps:
      - name: understand_ticket
        prompt: ticket_understander
      - name: discover_impact
        prompt: impact_analyzer
      - name: plan_implementation
        prompt: implementation_planner
      - name: draft_changes
        prompt: code_diff_generator
      - name: tests_and_validation
        prompt: test_author
      - name: summarize_for_ticket
        prompt: ticket_comment_summarizer

  refactor_scout:
    description: "Inspect a file for refactoring opportunities and draft an issue/ticket summary."
    steps:
      - name: analyze_refactor
        prompt: refactor_analyzer
      - name: plan_refactor
        prompt: refactor_plan
      - name: draft_ticket
        prompt: refactor_ticket_writer

  bug_triage:
    description: "Given a bug ticket/logs, triage, find impact, draft repro plan, and suggest a fix sketch plus ticket comment."
    steps:
      - name: parse_bug
        prompt: bug_parser
      - name: assess_impact
        prompt: impact_analyzer
      - name: plan_repro
        prompt: repro_planner
      - name: sketch_fix
        prompt: fix_sketcher
      - name: ticket_update
        prompt: bug_ticket_writer

  test_hardener:
    description: "Analyze test gaps for a file/path or failing output, propose tests, and draft a ticket note."
    steps:
      - name: analyze_gaps
        prompt: test_gap_analyzer
      - name: propose_tests
        prompt: test_author
      - name: draft_ticket
        prompt: test_ticket_writer

  doc_improver:
    description: "Review a doc file and propose quality improvements plus a ticket/PR note."
    steps:
      - name: analyze_doc
        prompt: doc_analyzer
      - name: outline_fix
        prompt: doc_outline_planner
      - name: draft_ticket
        prompt: doc_ticket_writer

  # Developer Experience Engineer Workflows
  onboarding_guide:
    description: "Create a comprehensive onboarding guide for new developers. Input can be a ticket describing onboarding needs, existing docs, or a project path."
    steps:
      - name: understand_requirements
        prompt: ticket_understander
      - name: analyze_existing_docs
        prompt: doc_analyzer
      - name: plan_onboarding_structure
        prompt: doc_outline_planner
      - name: draft_onboarding_guide
        prompt: doc_ticket_writer

  error_message_improver:
    description: "Analyze error messages and developer-facing feedback to improve clarity, actionability, and developer experience."
    steps:
      - name: analyze_error_messages
        prompt: impact_analyzer
      - name: plan_improvements
        prompt: implementation_planner
      - name: draft_improved_messages
        prompt: doc_ticket_writer

  migration_guide:
    description: "Create a migration guide for breaking changes, API updates, or major version upgrades. Input can be a ticket, changelog, or diff."
    steps:
      - name: understand_changes
        prompt: ticket_understander
      - name: assess_impact
        prompt: impact_analyzer
      - name: plan_migration_steps
        prompt: implementation_planner
      - name: draft_migration_guide
        prompt: doc_ticket_writer

  api_doc_improver:
    description: "Improve API documentation by analyzing code, existing docs, and developer feedback. Focus on clarity, examples, and completeness."
    steps:
      - name: analyze_api_docs
        prompt: doc_analyzer
      - name: assess_api_code
        prompt: impact_analyzer
      - name: plan_doc_improvements
        prompt: doc_outline_planner
      - name: draft_improved_docs
        prompt: doc_ticket_writer

  developer_feedback_analyzer:
    description: "Analyze developer feedback, surveys, or support tickets to identify common pain points and improvement opportunities."
    steps:
      - name: parse_feedback
        prompt: bug_parser
      - name: identify_patterns
        prompt: impact_analyzer
      - name: prioritize_improvements
        prompt: implementation_planner
      - name: draft_improvement_plan
        prompt: doc_ticket_writer

  troubleshooting_guide:
    description: "Create a troubleshooting guide from bug reports, error logs, or support tickets. Helps developers self-serve common issues."
    steps:
      - name: parse_issues
        prompt: bug_parser
      - name: categorize_problems
        prompt: impact_analyzer
      - name: plan_troubleshooting_steps
        prompt: repro_planner
      - name: draft_troubleshooting_guide
        prompt: doc_ticket_writer

  quickstart_creator:
    description: "Create a quickstart or getting started guide for developers. Analyzes project structure and creates step-by-step setup instructions."
    steps:
      - name: understand_project_structure
        prompt: ticket_understander
      - name: identify_setup_requirements
        prompt: impact_analyzer
      - name: plan_quickstart_steps
        prompt: doc_outline_planner
      - name: draft_quickstart_guide
        prompt: doc_ticket_writer

  ci_cd_dx_improver:
    description: "Improve CI/CD developer experience by analyzing pipeline failures, developer feedback, and proposing clearer error messages and faster feedback loops."
    steps:
      - name: analyze_ci_issues
        prompt: bug_parser
      - name: assess_developer_impact
        prompt: impact_analyzer
      - name: plan_dx_improvements
        prompt: implementation_planner
      - name: draft_improvement_proposal
        prompt: doc_ticket_writer
  
  sync_branch:
    description: "Rebase a branch onto a target branch (defaults to main/master), resolve merge conflicts, and force push. Input format: 'source-branch' or 'source-branch target-branch' (defaults to current branch if source not provided)."
    steps:
      - name: detect_branches
        prompt: git_rebase_resolver
      - name: fetch_and_rebase
        prompt: git_rebase_resolver
      - name: resolve_conflicts
        prompt: git_rebase_resolver
      - name: force_push
        prompt: git_rebase_resolver

  implement_with_aider:
    description: "Use Aider to implement code changes from a ticket, feature request, or task description. Supports both local (Ollama) and cloud (Claude) models."
    steps:
      - name: understand_requirements
        prompt: ticket_understander
      - name: plan_implementation
        prompt: implementation_planner
      - name: implement_with_aider
        prompt: aider_implementer
      - name: verify_changes
        prompt: test_author

  quick_refactor:
    description: "Quick refactoring task using Aider with local Ollama model. Perfect for proprietary code or cost-sensitive refactoring."
    steps:
      - name: analyze_code
        prompt: refactor_analyzer
      - name: refactor_with_aider
        prompt: aider_implementer

  # Code Review & Feedback Workflows
  address_pr_feedback:
    description: "Address Merge Request or Pull Request feedback comprehensively. Supports GitHub and GitLab. Analyzes review comments, implements changes, verifies solutions, and prepares for re-review."
    steps:
      - name: fetch_and_categorize_feedback
        prompt: pr_feedback_extractor
      - name: plan_response_strategy
        prompt: pr_feedback_planner
      - name: implement_changes
        prompt: code_diff_generator
      - name: verify_feedback_addressed
        prompt: pr_verification_checker
      - name: draft_response_comments
        prompt: pr_response_writer
      - name: prepare_for_review
        prompt: pr_review_prep

  code_reviewer:
    description: "Review a pull request, analyze code changes, suggest improvements, and draft review comments."
    steps:
      - name: understand_pr
        prompt: pr_understander
      - name: analyze_code_changes
        prompt: code_change_analyzer
      - name: suggest_improvements
        prompt: improvement_suggester
      - name: draft_review_comments
        prompt: review_comment_drafter
